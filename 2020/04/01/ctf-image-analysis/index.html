<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="CTF-Image Analysis,  信息安全 DeepLearning 计算机 查令十字街 chalingshizijie CTF 网络攻防 快乐的小菜鸡">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48">
    <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7">
    <meta name="description" content="写在前面：本文的大部分内容都源于 CTF-WIKI、维基百科和网络，如有补充和意见请发送邮件至 1316565360@qq.com
Forensic Steganography（取证与隐写）大部分的 CTF 比赛中，取证及隐写两者密不可分，">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CTF-Image Analysis | 查令十字街的博客</title>
    <link rel="icon" type="image/png" href="https://s1.ax1x.com/2020/03/31/GQUCM4.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://s1.ax1x.com/2020/03/31/GQUCM4.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">查令十字街的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-comments"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://s1.ax1x.com/2020/03/31/GQUCM4.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">查令十字街的博客</div>
        <div class="logo-desc">
            
            阅读 | 信息安全 | 快乐的小菜鸡
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-comments"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/21ni/" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/21ni/" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://s1.ax1x.com/2020/04/03/GNmNUP.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        CTF-Image Analysis
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/CTF/" target="_blank">
                            <span class="chip bg-color">CTF</span>
                        </a>
                        
                        <a href="/tags/Image-Analysis/" target="_blank">
                            <span class="chip bg-color">Image Analysis</span>
                        </a>
                        
                        <a href="/tags/总结/" target="_blank">
                            <span class="chip bg-color">总结</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/CTF/" class="post-category" target="_blank">
                            CTF
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-04-01
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    查令十字街
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    9.4k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    35 分
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>写在前面：本文的大部分内容都源于 CTF-WIKI、维基百科和网络，如有补充和意见请发送邮件至 <a href="mailto:1316565360@qq.com" target="_blank" rel="noopener">1316565360@qq.com</a></p>
<h1 id="Forensic-Steganography（取证与隐写）"><a href="#Forensic-Steganography（取证与隐写）" class="headerlink" title="Forensic Steganography（取证与隐写）"></a>Forensic Steganography（取证与隐写）</h1><p>大部分的 CTF 比赛中，取证及隐写两者密不可分，两者所需要的知识也相辅相成，所以这里也将对两者一起介绍。</p>
<p>任何要求检查一个静态数据文件从而获取隐藏信息的都可以被认为是隐写取证题（除非单纯地是密码学的知识），一些低分的隐写取证又常常与古典密码学结合在一起，而高分的题目则通常用与一些较为复杂的现代密码学知识结合在一起，很好地体现了 Misc 题的特点。</p>
<h2 id="前置技能"><a href="#前置技能" class="headerlink" title="前置技能"></a>前置技能</h2><ul>
<li><p>了解常见的编码</p>
</li>
<li><p>能够对文件中出现的一些编码进行解码，并且对一些特殊的编码（Base64、十六进制、二进制等）有一定的敏感度，对其进行转换并得到最终的 flag。</p>
</li>
<li><p>能够利用脚本语言（Python 等）去操作二进制数据</p>
</li>
<li><p>熟知常见文件的文件格式，尤其是各类 文件头、协议、结构等</p>
</li>
<li><p>灵活运用常见的工具</p>
</li>
</ul>
<h2 id="Python-操作二进制数据"><a href="#Python-操作二进制数据" class="headerlink" title="Python 操作二进制数据"></a>Python 操作二进制数据</h2><h3 id="struct-模块"><a href="#struct-模块" class="headerlink" title="struct 模块"></a>struct 模块</h3><p>有的时候需要用 Python 处理二进制数据，比如，存取文件，socket 操作时。这时候，可以使用 Python 的 struct 模块来完成。</p>
<p>struct 模块中最重要的三个函数是 pack ()、unpack () 和 calcsize ()</p>
<p>pack (fmt, v1, v2, …) 按照给定的格式（fmt），把数据封装成字符串（实际上是类似于 c 结构体的字节流）<br>unpack (fmt, string) 按照给定的格式（fmt）解析字节流 string，返回解析出来的 tuple<br>calcsize (fmt) 计算给定的格式（fmt）占用多少字节的内存<br>这里打包格式 fmt 确定了将变量按照什么方式打包成字节流，其包含了一系列的格式字符串。这里就不再给出不同格式字符串的含义了，详细细节可以参照 Python Doc (已有中文版)</p>
<pre><code>&gt;&gt;&gt; import struct
&gt;&gt;&gt; struct.pack (&#39;&gt;I&#39;,16)
&#39;\x00\x00\x00\x10&#39;</code></pre><p>pack 的第一个参数是处理指令，’&gt;I’ 的意思是：&gt; 表示字节顺序是 Big-Endian，也就是网络序，I 表示 4 字节无符号整数。</p>
<p>后面的参数个数要和处理指令一致。</p>
<p>读入一个 BMP（一种图像格式，详见 <a href="https://blog.csdn.net/qingchuwudi/article/details/25785307" target="_blank" rel="noopener">位图 (bmp) 文件格式分析</a>） 文件的前 30 字节，文件头的结构按顺序如下</p>
<p>两个字节：BM 表示 Windows 位图，BA 表示 OS/2 位图<br>一个 4 字节整数：表示位图大小<br>一个 4 字节整数：保留位，始终为 0<br>一个 4 字节整数：实际图像的偏移量<br>一个 4 字节整数：Header 的字节数<br>一个 4 字节整数：图像宽度<br>一个 4 字节整数：图像高度<br>一个 2 字节整数：始终为 1<br>一个 2 字节整数：颜色数</p>
<pre><code>&gt;&gt;&gt; import struct
&gt;&gt;&gt; bmp = &#39;\x42\x4d\x38\x8c\x0a\x00\x00\x00\x00\x00\x36\x00\x00\x00\x28\x00\x00\x00\x80\x02\x00\x00\x68\x01\x00\x00\x01\x00\x18\x00&#39;
&gt;&gt;&gt; struct.unpack (&#39;&lt;ccIIIIIIHH&#39;,bmp)
(&#39;B&#39;, &#39;M&#39;, 691256, 0, 54, 40, 640, 360, 1, 24)</code></pre><h3 id="bytearray-字节数组"><a href="#bytearray-字节数组" class="headerlink" title="bytearray 字节数组"></a>bytearray 字节数组</h3><p>将文件以二进制数组形式读取</p>
<pre><code>data = bytearray (open (&#39;challenge.png&#39;, &#39;rb&#39;).read ())</code></pre><p>字节数组就是可变版本的字节</p>
<pre><code>data [0] = &#39;\x89&#39;</code></pre><h2 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h2><h3 id="010-Editor"><a href="#010-Editor" class="headerlink" title="010 Editor"></a>010 Editor</h3><p>SweetScape 010 Editor 是一个全新的十六进位文件编辑器，它有别于传统的十六进位编辑器在于它可用「范本」来解析二进位文件，从而让你读懂和编辑它。它还可用来比较一切可视的二进位文件。</p>
<p>利用它的模板功能可以非常轻松的观察文件内部的具体结构并且依此快速更改内容。</p>
<h3 id="file-命令（linux-命令）"><a href="#file-命令（linux-命令）" class="headerlink" title="file 命令（linux 命令）"></a>file 命令（linux 命令）</h3><p>file 命令根据文件头（魔法字节）去识别一个文件的文件类型。</p>
<pre><code>root in ~/Desktop/tmp λ file flag
flag: PNG image data, 450 x 450, 8-bit grayscale, non-interlaced    </code></pre><h3 id="strings-命令（linux-命令）"><a href="#strings-命令（linux-命令）" class="headerlink" title="strings 命令（linux 命令）"></a>strings 命令（linux 命令）</h3><p>打印文件中可打印的字符，经常用来发现文件中的一些提示信息或是一些特殊的编码信息，常常用来发现题目的突破口。</p>
<p>可以配合 grep 命令探测指定信息</p>
<pre><code>strings test|grep -i XXCTF</code></pre><p>也可以配合 -o 参数获取所有 ASCII 字符偏移</p>
<pre><code>root in ~/Desktop/tmp λ strings -o flag|head
    14 IHDR
    45 gAMA
    64  cHRM
    141 bKGD
    157 tIME
    202 IDATx
    223 NFdVK3
    361 |;*-
    410 Ge%&lt;W
    431 5duX@%</code></pre><h3 id="binwalk-命令"><a href="#binwalk-命令" class="headerlink" title="binwalk 命令"></a>binwalk 命令</h3><p>binwalk 本是一个固件的分析工具，比赛中常用来发现多个文件粘合再在一起的情况。根据文件头去识别一个文件中夹杂的其他文件，有时也会存在误报率（尤其是对 Pcap 流量包等文件时）。</p>
<blockquote>
<p>Binwalk 是一个快速，易于使用的工具，用于分析，逆向工程和提取固件映像。 官方给出的用途是提取固件镜像，然而，我们在做一些隐写类的题目的时候，Binwalk 这个工具非常方便。最好在 *nix 系统下使用，如果你的 Windows 版本是 1703 及以上，那么在 WSL 中安装 binwalk 是个不错的选择。</p>
</blockquote>
<pre><code>root in ~/Desktop/tmp λ binwalk flag

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PNG image, 450 x 450, 8-bit grayscale, non-interlaced
134           0x86            Zlib compressed data, best compression
25683         0x6453          Zip archive data, at least v2.0 to extract, compressed size: 675, uncompressed size: 1159, name: readme.txt
26398         0x671E          Zip archive data, at least v2.0 to extract, compressed size: 430849, uncompressed size: 1027984, name: trid
457387        0x6FAAB         End of Zip archive</code></pre><p>配合 -e 参数可以进行自动化提取。</p>
<p>也可以结合 dd 命令进行手动切割。</p>
<pre><code>root in ~/Desktop/tmp λ dd if=flag of=1.zip bs=1 skip=25683
431726+0 records in
431726+0 records out
431726 bytes (432 kB, 422 KiB) copied, 0.900973 s, 479 kB/s</code></pre><p>如果你还指定了 -M 选项，binwalk 甚至会递归扫描文件，因为它会提取它们<br>如果指定了 -r 选项，则将自动删除无法提取的任何文件签名或导致大小为 0 的文件</p>
<p>图像文件能够很好地包含黑客文化，因此 CTF 竞赛中经常会出现各种图像文件。</p>
<p>图像文件有多种复杂的格式，可以用于各种涉及到元数据、信息丢失和无损压缩、校验、隐写或可视化数据编码的分析解密，都是 Misc 中的一个很重要的出题方向。涉及到的知识点很多（包括基本的文件格式，常见的隐写手法及隐写用的软件），有的地方也需要去进行深入的理解。</p>
<h1 id="Introduction-to-Image-Analysis"><a href="#Introduction-to-Image-Analysis" class="headerlink" title="Introduction to Image Analysis"></a>Introduction to Image Analysis</h1><h2 id="元数据（Metadata）"><a href="#元数据（Metadata）" class="headerlink" title="元数据（Metadata）"></a>元数据（Metadata）</h2><blockquote>
<p>元数据（Metadata），又称中介数据、中继数据，为描述数据的数据（Data about data），主要是描述数据属性（property）的信息，用来支持如指示存储位置、历史数据、资源查找、文件记录等功能。</p>
</blockquote>
<p>元数据中隐藏信息在比赛中是最基本的一种手法，通常用来隐藏一些关键的 <code>Hint</code> 信息或者是一些重要的如 <code>password</code> 等信息。</p>
<p>这类元数据你可以 <code>右键 --&gt; 属性</code> 去查看，也可以通过 <code>strings</code> 命令去查看，一般来说，一些隐藏的信息（奇怪的字符串）常常出现在头部或者尾部。</p>
<p>接下来介绍一个 <code>identify</code> 命令，这个命令是用来获取一个或多个图像文件的格式和特性。</p>
<p><code>-format</code> 用来指定显示的信息，灵活使用它的 <code>-format</code> 参数可以给解题带来不少方便。<a href="https://www.imagemagick.org/script/escape.php" target="_blank" rel="noopener">format 各个参数具体意义</a></p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p><a href="https://github.com/ctfs/write-ups-2017/tree/master/breakin-ctf-2017/misc/Mysterious-GIF" target="_blank" rel="noopener">Break In 2017 - Mysterious GIF</a></p>
<p>这题的一个难点是发现并提取 GIF 中的元数据，首先 <code>strings</code> 是可以观察到异常点的。</p>
<pre class="line-numbers language-shell"><code class="language-shell">GIF89a
   !!!"""###$$$%%%&&&'''((()))***+++,,,---...///000111222333444555666777888999:::;;;<<<===>>>???@@@AAABBBCCCDDDEEEFFFGGGHHHIIIJJJKKKLLLMMMNNNOOOPPPQQQRRRSSSTTTUUUVVVWWWXXXYYYZZZ [[[\\\]]]^^^___```aaabbbcccdddeeefffggghhhiiijjjkkklllmmmnnnooopppqqqrrrssstttuuuvvvwwwxxxyyyzzz {{{|||}}}~~~
4d494945767749424144414e42676b71686b6947397730424151454641415343424b6b776767536c41674541416f4942415144644d4e624c3571565769435172
NETSCAPE2.0
ImageMagick
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里的一串 16 进制其实是藏在 GIF 的元数据区</p>
<p>接下来就是提取，你可以选择 Python，但是利用 <code>identify</code> 显得更加便捷</p>
<pre class="line-numbers language-shell"><code class="language-shell">root in ~/Desktop/tmp λ identify -format "% s % c \n" Question.gif
0 4d494945767749424144414e42676b71686b6947397730424151454641415343424b6b776767536c41674541416f4942415144644d4e624c3571565769435172
1 5832773639712f377933536849507565707478664177525162524f72653330633655772f6f4b3877655a547834346d30414c6f75685634364b63514a6b687271
...
24 484b7735432b667741586c4649746d30396145565458772b787a4c4a623253723667415450574d35715661756278667362356d58482f77443969434c684a536f
25 724b3052485a6b745062457335797444737142486435504646773d3d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其他过程这里不在叙述，可参考链接中的 Writeup</p>
<h2 id="像素值转化"><a href="#像素值转化" class="headerlink" title="像素值转化"></a>像素值转化</h2><p>看看这个文件里的数据，你能想到什么？</p>
<pre><code>255,255,255,255,255...........</code></pre><p>是一串 RGB 值，尝试着将他转化为图片</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> re

x <span class="token operator">=</span> <span class="token number">307</span> <span class="token comment" spellcheck="true">#x 坐标  通过对 txt 里的行数进行整数分解</span>
y <span class="token operator">=</span> <span class="token number">311</span> <span class="token comment" spellcheck="true">#y 坐标  x*y = 行数</span>

rgb1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">**</span><span class="token operator">**</span><span class="token punctuation">]</span>
<span class="token keyword">print</span> len <span class="token punctuation">(</span>rgb1<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span>
m<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> xrange <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> xrange <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>

        line <span class="token operator">=</span> rgb1 <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">*</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">*</span><span class="token punctuation">(</span>m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true"># 获取一行</span>
        m<span class="token operator">+=</span><span class="token number">1</span>
        rgb <span class="token operator">=</span> line

        im<span class="token punctuation">.</span>putpixel <span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>int <span class="token punctuation">(</span>rgb <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>int <span class="token punctuation">(</span>rgb <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>int <span class="token punctuation">(</span>rgb <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#rgb 转化为像素</span>
im<span class="token punctuation">.</span>show <span class="token punctuation">(</span><span class="token punctuation">)</span>
im<span class="token punctuation">.</span>save <span class="token punctuation">(</span><span class="token string">"flag.png"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>而如果反过来的话，从一张图片提取 RGB 值，再对 RGB 值去进行一些对比，从而得到最终的 flag。</p>
<p>这类题目大部分都是一些像素块组成的图片，如下图</p>
<p><img src="https://s1.ax1x.com/2020/04/01/G8gDtf.png" alt></p>
<p>相关题目:</p>
<ul>
<li><a href="https://github.com/ctfs/write-ups-2016/tree/master/csaw-ctf-2016-quals/forensics/brainfun-50" target="_blank" rel="noopener">CSAW-2016-quals:Forensic/Barinfun</a></li>
<li><a href="https://github.com/ctfs/write-ups-2017/tree/master/breakin-ctf-2017/misc/A-dance-partner" target="_blank" rel="noopener">breakin-ctf-2017:A-dance-partner</a></li>
</ul>
<h1 id="PNG"><a href="#PNG" class="headerlink" title="PNG"></a>PNG</h1><h2 id="文件格式"><a href="#文件格式" class="headerlink" title="文件格式"></a>文件格式</h2><p>对于一个 PNG 文件来说，其文件头总是由位固定的字节来描述的，剩余的部分由 3 个以上的 PNG 的数据块（Chunk）按照特定的顺序组成。</p>
<p>文件头 <code>89 50 4E 47 0D 0A 1A 0A</code> + 数据块 + 数据块 + 数据块……</p>
<h3 id="数据块-CHUNk"><a href="#数据块-CHUNk" class="headerlink" title="数据块 CHUNk"></a>数据块 CHUNk</h3><p>PNG 定义了两种类型的数据块，一种是称为关键数据块（critical chunk），这是标准的数据块，另一种叫做辅助数据块（ancillary chunks），这是可选的数据块。关键数据块定义了 4 个标准数据块，每个 PNG 文件都必须包含它们，PNG 读写软件也都必须要支持这些数据块。</p>
<table>
<thead>
<tr>
<th>数据块符号</th>
<th>数据块名称</th>
<th>多数据块</th>
<th>可选否</th>
<th>位置限制</th>
</tr>
</thead>
<tbody><tr>
<td>IHDR</td>
<td>文件头数据块</td>
<td>否</td>
<td>否</td>
<td>第一块</td>
</tr>
<tr>
<td>cHRM</td>
<td>基色和白色点数据块</td>
<td>否</td>
<td>是</td>
<td>在 PLTE 和 IDAT 之前</td>
</tr>
<tr>
<td>gAMA</td>
<td>图像 γ 数据块</td>
<td>否</td>
<td>是</td>
<td>在 PLTE 和 IDAT 之前</td>
</tr>
<tr>
<td>sBIT</td>
<td>样本有效位数据块</td>
<td>否</td>
<td>是</td>
<td>在 PLTE 和 IDAT 之前</td>
</tr>
<tr>
<td>PLTE</td>
<td>调色板数据块</td>
<td>否</td>
<td>是</td>
<td>在 IDAT 之前</td>
</tr>
<tr>
<td>bKGD</td>
<td>背景颜色数据块</td>
<td>否</td>
<td>是</td>
<td>在 PLTE 之后 IDAT 之前</td>
</tr>
<tr>
<td>hIST</td>
<td>图像直方图数据块</td>
<td>否</td>
<td>是</td>
<td>在 PLTE 之后 IDAT 之前</td>
</tr>
<tr>
<td>tRNS</td>
<td>图像透明数据块</td>
<td>否</td>
<td>是</td>
<td>在 PLTE 之后 IDAT 之前</td>
</tr>
<tr>
<td>oFFs</td>
<td>(专用公共数据块）</td>
<td>否</td>
<td>是</td>
<td>在 IDAT 之前</td>
</tr>
<tr>
<td>pHYs</td>
<td>物理像素尺寸数据块</td>
<td>否</td>
<td>是</td>
<td>在 IDAT 之前</td>
</tr>
<tr>
<td>sCAL</td>
<td>(专用公共数据块）</td>
<td>否</td>
<td>是</td>
<td>在 IDAT 之前</td>
</tr>
<tr>
<td>IDAT</td>
<td>图像数据块</td>
<td>是</td>
<td>否</td>
<td>与其他 IDAT 连续</td>
</tr>
<tr>
<td>tIME</td>
<td>图像最后修改时间数据块</td>
<td>否</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>tEXt</td>
<td>文本信息数据块</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>zTXt</td>
<td>压缩文本数据块</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>fRAc</td>
<td>(专用公共数据块）</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>gIFg</td>
<td>(专用公共数据块）</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>gIFt</td>
<td>(专用公共数据块）</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>gIFx</td>
<td>(专用公共数据块）</td>
<td>是</td>
<td>是</td>
<td>无限制</td>
</tr>
<tr>
<td>IEND</td>
<td>图像结束数据</td>
<td>否</td>
<td>否</td>
<td>最后一个数据块</td>
</tr>
</tbody></table>
<p>对于每个数据块都有着统一的数据结构，每个数据块由 4 个部分组成</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>字节数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Length（长度）</td>
<td>4 字节</td>
<td>指定数据块中数据域的长度，其长度不超过（231－1）字节</td>
</tr>
<tr>
<td>Chunk Type Code（数据块类型码）</td>
<td>4 字节</td>
<td>数据块类型码由 ASCII 字母（A - Z 和 a - z）组成</td>
</tr>
<tr>
<td>Chunk Data（数据块数据）</td>
<td>可变长度</td>
<td>存储按照 Chunk Type Code 指定的数据</td>
</tr>
<tr>
<td>CRC（循环冗余检测）</td>
<td>4 字节</td>
<td>存储用来检测是否有错误的循环冗余码</td>
</tr>
</tbody></table>
<p>CRC（Cyclic Redundancy Check）域中的值是对 Chunk Type Code 域和 Chunk Data 域中的数据进行计算得到的。</p>
<h3 id="IHDR"><a href="#IHDR" class="headerlink" title="IHDR"></a>IHDR</h3><p>文件头数据块 IHDR（Header Chunk）：它包含有 PNG 文件中存储的图像数据的基本信息，由 13 字节组成，并要作为第一个数据块出现在 PNG 数据流中，而且一个 PNG 数据流中只能有一个文件头数据块</p>
<p>其中我们关注的是前 8 字节的内容</p>
<table>
<thead>
<tr>
<th>域的名称</th>
<th>字节数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Width</td>
<td>4 bytes</td>
<td>图像宽度，以像素为单位</td>
</tr>
<tr>
<td>Height</td>
<td>4 bytes</td>
<td>图像高度，以像素为单位</td>
</tr>
</tbody></table>
<p>我们经常会去更改一张图片的高度或者宽度使得一张图片显示不完整从而达到隐藏信息的目的。</p>
<p><img src="https://s1.ax1x.com/2020/04/01/G8gLu9.png" alt></p>
<p>这里可以发现在 Kali 中是打不开这张图片的，提示 <code>IHDR CRC error</code>，而 Windows 10 自带的图片查看器能够打开，就提醒了我们 IHDR 块被人为的篡改过了，从而尝试修改图片的高度或者宽度发现隐藏的字符串。</p>
<h4 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h4><h5 id="WDCTF-finals-2017"><a href="#WDCTF-finals-2017" class="headerlink" title="WDCTF-finals-2017"></a>WDCTF-finals-2017</h5><p>观察文件可以发现，文件头及宽度异常</p>
<pre class="line-numbers language-hex"><code class="language-hex">00000000  80 59 4e 47 0d 0a 1a 0a  00 00 00 0d 49 48 44 52  |.YNG........IHDR|
00000010  00 00 00 00 00 00 02 f8  08 06 00 00 00 93 2f 8a  |............../.|
00000020  6b 00 00 00 04 67 41 4d  41 00 00 9c 40 20 0d e4  |k....gAMA...@ ..|
00000030  cb 00 00 00 20 63 48 52  4d 00 00 87 0f 00 00 8c  |.... cHRM.......|
00000040  0f 00 00 fd 52 00 00 81  40 00 00 7d 79 00 00 e9  |....R...@..} y...|
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里需要注意的是，文件宽度不能任意修改，需要根据 IHDR 块的 CRC 值爆破得到宽度，否则图片显示错误不能得到 flag。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> binascii
<span class="token keyword">import</span> struct


misc <span class="token operator">=</span> open <span class="token punctuation">(</span><span class="token string">"misc4.png"</span><span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read <span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range <span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> misc <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">+</span> struct<span class="token punctuation">.</span>pack <span class="token punctuation">(</span><span class="token string">'>i'</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token operator">+</span> misc <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">]</span>
    crc32 <span class="token operator">=</span> binascii<span class="token punctuation">.</span>crc32 <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffff</span>
    <span class="token keyword">if</span> crc32 <span class="token operator">==</span> <span class="token number">0x932f8a6b</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到宽度值为 709 后，恢复图片得到 flag。</p>
<p><img src="https://s1.ax1x.com/2020/04/01/G8gHc4.png" alt></p>
<h3 id="PLTE"><a href="#PLTE" class="headerlink" title="PLTE"></a>PLTE</h3><p>调色板数据块 PLTE（palette chunk）：它包含有与索引彩色图像（indexed-color image）相关的彩色变换数据，它仅与索引彩色图像有关，而且要放在图像数据块（image data<br>chunk）之前。真彩色的 PNG 数据流也可以有调色板数据块，目的是便于非真彩色显示程序用它来量化图像数据，从而显示该图像。</p>
<h3 id="IDAT"><a href="#IDAT" class="headerlink" title="IDAT"></a>IDAT</h3><p>图像数据块 IDAT（image data chunk）：它存储实际的数据，在数据流中可包含多个连续顺序的图像数据块。</p>
<ul>
<li>储存图像像数数据</li>
<li>在数据流中可包含多个连续顺序的图像数据块</li>
<li>采用 LZ77 算法的派生算法进行压缩</li>
<li>可以用 zlib 解压缩</li>
</ul>
<p>值得注意的是，IDAT 块只有当上一个块充满时，才会继续一个新的块。</p>
<p>用 <code>pngcheck</code> 去查看此 PNG 文件</p>
<pre class="line-numbers language-shell"><code class="language-shell">λ .\pngcheck.exe -v sctf.png
File: sctf.png (1421461 bytes)
  chunk IHDR at offset 0x0000c, length 13
    1000 x 562 image, 32-bit RGB+alpha, non-interlaced
  chunk sRGB at offset 0x00025, length 1
    rendering intent = perceptual
  chunk gAMA at offset 0x00032, length 4: 0.45455
  chunk pHYs at offset 0x00042, length 9: 3780x3780 pixels/meter (96 dpi)
  chunk IDAT at offset 0x00057, length 65445
    zlib: deflated, 32K window, fast compression
  chunk IDAT at offset 0x10008, length 65524
...
  chunk IDAT at offset 0x150008, length 45027
  chunk IDAT at offset 0x15aff7, length 138
  chunk IEND at offset 0x15b08d, length 0
No errors detected in sctf.png (28 chunks, 36.8% compression).<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到，正常的块的 length 是在 65524 的时候就满了，而倒数第二个 IDAT 块长度是 45027，最后一个长度是 138，很明显最后一个 IDAT 块是有问题的，因为他本来应该并入到倒数第二个未满的块里.</p>
<p>利用 <code>python zlib</code> 解压多余 IDAT 块的内容，此时注意剔除 <em><em> 长度、数据块类型及末尾的 CRC 校验值 </em></em>。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> zlib
<span class="token keyword">import</span> binascii
IDAT <span class="token operator">=</span> <span class="token string">"789...667"</span><span class="token punctuation">.</span>decode <span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> binascii<span class="token punctuation">.</span>hexlify <span class="token punctuation">(</span>zlib<span class="token punctuation">.</span>decompress <span class="token punctuation">(</span>IDAT<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> result<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="IEND"><a href="#IEND" class="headerlink" title="IEND"></a>IEND</h3><p>图像结束数据 IEND（image trailer chunk）：它用来标记 PNG 文件或者数据流已经结束，并且必须要放在文件的尾部。</p>
<pre><code>00 00 00 00 49 45 4E 44 AE 42 60 82</code></pre><p>IEND 数据块的长度总是 <code>00 00 00 00</code>，数据标识总是 IEND <code>49 45 4E 44</code>，因此，CRC 码也总是 <code>AE 42 60 82</code>。</p>
<h3 id="其余辅助数据块"><a href="#其余辅助数据块" class="headerlink" title="其余辅助数据块"></a>其余辅助数据块</h3><ul>
<li>背景颜色数据块 bKGD（background color）</li>
<li>基色和白色度数据块 cHRM（primary chromaticities and white point），所谓白色度是指当 <code>R＝G＝B＝最大值</code> 时在显示器上产生的白色度</li>
<li>图像 γ 数据块 gAMA（image gamma）</li>
<li>图像直方图数据块 hIST（image histogram）</li>
<li>物理像素尺寸数据块 pHYs（physical pixel dimensions）</li>
<li>样本有效位数据块 sBIT（significant bits）</li>
<li>文本信息数据块 tEXt（textual data）</li>
<li>图像最后修改时间数据块 tIME （image last-modification time）</li>
<li>图像透明数据块 tRNS （transparency）</li>
<li>压缩文本数据块 zTXt （compressed textual data）</li>
</ul>
<h2 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h2><p>LSB 全称 Least Significant Bit，最低有效位。PNG 文件中的图像像数一般是由 RGB 三原色（红绿蓝）组成，每一种颜色占用 8 位，取值范围为 <code>0x00</code> 至 <code>0xFF</code>，即有 256 种颜色，一共包含了 256 的 3 次方的颜色，即 16777216 种颜色。</p>
<p>而人类的眼睛可以区分约 1000 万种不同的颜色，意味着人类的眼睛无法区分余下的颜色大约有 6777216 种。</p>
<p>LSB 隐写就是修改 RGB 颜色分量的最低二进制位（LSB），每个颜色会有 8 bit，LSB 隐写就是修改了像数中的最低的 1 bit，而人类的眼睛不会注意到这前后的变化，每个像素可以携带 3 比特的信息。</p>
<p><img src="https://s1.ax1x.com/2020/04/01/G8gIhT.jpg" alt></p>
<p>如果是要寻找这种 LSB 隐藏痕迹的话，有一个工具 <a href="http://www.caesum.com/handbook/Stegsolve.jar" target="_blank" rel="noopener">Stegsolve</a> 是个神器，可以来辅助我们进行分析。</p>
<p>通过下方的按钮可以观察每个通道的信息，例如查看 R 通道的最低位第 8 位平面的信息。</p>
<p><img src="https://s1.ax1x.com/2020/04/01/G8gT9U.png" alt></p>
<p>LSB 的信息借助于 Stegsolve 查看各个通道时一定要细心捕捉异常点，抓住 LSB 隐写的蛛丝马迹。</p>
<h3 id="例题-2"><a href="#例题-2" class="headerlink" title="例题"></a>例题</h3><blockquote>
<p>HCTF - 2016 - Misc</p>
</blockquote>
<p>这题的信息隐藏在 RGB 三个通道的最低位中，借助 <code>Stegsolve--&gt;Analyse--&gt;Data Extract</code> 可以指定通道进行提取。</p>
<p><img src="https://s1.ax1x.com/2020/04/01/G8gf7q.png" alt></p>
<p>可以发现 <code>zip</code> 头，用 <code>save bin</code> 保存为压缩包后，打开运行其中的 ELF 文件就可以得到最后的 flag。</p>
<blockquote>
<p>更多关于 LSB 的研究可以看 <a href="https://zhuanlan.zhihu.com/p/23890677" target="_blank" rel="noopener">这里</a>。</p>
</blockquote>
<h2 id="隐写软件"><a href="#隐写软件" class="headerlink" title="隐写软件"></a>隐写软件</h2><p><a href="http://domnit.org/stepic/doc/" target="_blank" rel="noopener">Stepic</a></p>
<h1 id="JPG"><a href="#JPG" class="headerlink" title="JPG"></a>JPG</h1><h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><ul>
<li>JPEG 是有损压缩格式，将像素信息用 JPEG 保存成文件再读取出来，其中某些像素值会有少许变化。在保存时有个质量参数可在 0 至 100 之间选择，参数越大图片就越保真，但图片的体积也就越大。一般情况下选择 70 或 80 就足够了</li>
<li>JPEG 没有透明度信息</li>
</ul>
<p>JPG 基本数据结构为两大类型：「段」和经过压缩编码的图像数据。</p>
<table>
<thead>
<tr>
<th>名 称</th>
<th>字节数</th>
<th>数据</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>段 标识</td>
<td>1</td>
<td>FF</td>
<td>每个新段的开始标识</td>
</tr>
<tr>
<td>段类型</td>
<td>1</td>
<td></td>
<td>类型编码（称作标记码）</td>
</tr>
<tr>
<td>段长 度</td>
<td>2</td>
<td></td>
<td>包括段内容和段长度本身，不包括段标识和段类型</td>
</tr>
<tr>
<td>段内容</td>
<td>2</td>
<td></td>
<td>≤65533 字节</td>
</tr>
</tbody></table>
<ul>
<li>有些段没有长度描述也没有内容，只有段标识和段类型。文件头和文件尾均属于这种段。</li>
<li>段与段之间无论有多少 <code>FF</code> 都是合法的，这些 <code>FF</code> 称为「填充字节」，必须被忽略掉。</li>
</ul>
<p>一些常见的段类型</p>
<p><img src="https://s1.ax1x.com/2020/04/01/G8g5NV.png" alt></p>
<p><code>0xffd8</code> 和 <code>0xffd9</code> 为 JPG 文件的开始结束的标志。</p>
<h2 id="隐写软件-1"><a href="#隐写软件-1" class="headerlink" title="隐写软件"></a>隐写软件</h2><h3 id="Stegdetect"><a href="#Stegdetect" class="headerlink" title="Stegdetect"></a><a href="https://github.com/redNixon/stegdetect" target="_blank" rel="noopener">Stegdetect</a></h3><p>通过统计分析技术评估 JPEG 文件的 DCT 频率系数的隐写工具，可以检测到通过 JSteg、JPHide、OutGuess、Invisible<br>Secrets、F5、appendX 和 Camouflage 等这些隐写工具隐藏的信息，并且还具有基于字典暴力破解密码方法提取通过 Jphide、outguess 和 jsteg-shell 方式嵌入的隐藏信息。</p>
<pre class="line-numbers language-shell"><code class="language-shell">-q 仅显示可能包含隐藏内容的图像。
-n 启用检查 JPEG 文件头功能，以降低误报率。如果启用，所有带有批注区域的文件将被视为没有被嵌入信息。如果 JPEG 文件的 JFIF 标识符中的版本号不是 1.1，则禁用 OutGuess 检测。
-s 修改检测算法的敏感度，该值的默认值为 1。检测结果的匹配度与检测算法的敏感度成正比，算法敏感度的值越大，检测出的可疑文件包含敏感信息的可能性越大。
-d 打印带行号的调试信息。
-t 设置要检测哪些隐写工具（默认检测 jopi），可设置的选项如下：
j 检测图像中的信息是否是用 jsteg 嵌入的。
o 检测图像中的信息是否是用 outguess 嵌入的。
p 检测图像中的信息是否是用 jphide 嵌入的。
i 检测图像中的信息是否是用 invisible secrets 嵌入的。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="JPHS"><a href="#JPHS" class="headerlink" title="JPHS"></a><a href="http://linux01.gwdg.de/~alatham/stego.html" target="_blank" rel="noopener">JPHS</a></h3><p>JPEG 图像的信息隐藏软件 JPHS，它是由 Allan Latham 开发设计实现在 Windows 和 Linux 系统平台针对有损压缩 JPEG 文件进行信息加密隐藏和探测提取的工具。软件里面主要包含了两个程序 JPHIDE 和 JPSEEK。JPHIDE 程序主要是实现将信息文件加密隐藏到 JPEG 图像功能，而 JPSEEK 程序主要实现从用 JPHIDE 程序加密隐藏得到的 JPEG 图像探测提取信息文件，Windows 版本的 JPHS 里的 JPHSWIN 程序具有图形化操作界面且具备 JPHIDE 和 JPSEEK 的功能。</p>
<h3 id="SilentEye"><a href="#SilentEye" class="headerlink" title="SilentEye"></a><a href="http://silenteye.v1kings.io/" target="_blank" rel="noopener">SilentEye</a></h3><blockquote>
<p>SilentEye is a cross-platform application design for an easy use of steganography, in this case hiding messages into pictures or sounds. It provides a pretty nice interface and an easy integration of new steganography algorithm and cryptography process by using a plug-ins system.</p>
</blockquote>
<h1 id="GIF"><a href="#GIF" class="headerlink" title="GIF"></a>GIF</h1><h2 id="文件结构-1"><a href="#文件结构-1" class="headerlink" title="文件结构"></a>文件结构</h2><p>一个 GIF 文件的结构可分为</p>
<ul>
<li>文件头（File Header）<ul>
<li>GIF 文件署名（Signature）</li>
<li>版本号（Version）</li>
</ul>
</li>
<li>GIF 数据流（GIF Data Stream）<ul>
<li>控制标识符</li>
<li>图象块（Image Block）</li>
<li>其他的一些扩展块</li>
</ul>
</li>
<li>文件终结器（Trailer）</li>
</ul>
<p>下表显示了一个 GIF 文件的组成结构：</p>
<p><img src="https://s1.ax1x.com/2020/04/01/G8gRns.png" alt></p>
<p>中间的那个大块可以被重复任意次</p>
<h3 id="文件头"><a href="#文件头" class="headerlink" title="文件头"></a>文件头</h3><p>GIF 署名（Signature）和版本号（Version）。GIF 署名用来确认一个文件是否是 GIF 格式的文件，这一部分由三个字符组成：<code>GIF</code>；文件版本号也是由三个字节组成，可以为 <code>87a</code> 或 <code>89a</code>。</p>
<h3 id="逻辑屏幕标识符（Logical-Screen-Descriptor）"><a href="#逻辑屏幕标识符（Logical-Screen-Descriptor）" class="headerlink" title="逻辑屏幕标识符（Logical Screen Descriptor）"></a>逻辑屏幕标识符（Logical Screen Descriptor）</h3><p>Logical Screen Descriptor（逻辑屏幕描述符）紧跟在 header 后面。这个块告诉 decoder（解码器）图片需要占用的空间。它的大小固定为 7 个字节，以 canvas width（画布宽度）和 canvas height（画布高度）开始。</p>
<h3 id="全局颜色列表（Global-Color-Table）"><a href="#全局颜色列表（Global-Color-Table）" class="headerlink" title="全局颜色列表（Global Color Table）"></a>全局颜色列表（Global Color Table）</h3><p>GIF 格式可以拥有 global color table，或用于针对每个子图片集，提供 local color table。每个 color<br>table 由一个 RGB（就像通常我们见到的（255，0，0）红色 那种）列表组成。</p>
<h3 id="图像标识符（Image-Descriptor）"><a href="#图像标识符（Image-Descriptor）" class="headerlink" title="图像标识符（Image Descriptor）"></a>图像标识符（Image Descriptor）</h3><p>一个 GIF 文件一般包含多个图片。之前的图片渲染模式一般是将多个图片绘制到一个大的（virtual<br>canvas）虚拟画布上，而现在一般将这些图片集用于实现动画。</p>
<p>每个 image 都以一个 image descriptor block（图像描述块）作为开头，这个块固定为 10 字节。</p>
<p><img src="https://s1.ax1x.com/2020/04/01/G8gy9S.png" alt></p>
<h3 id="图像数据（Image-Data）"><a href="#图像数据（Image-Data）" class="headerlink" title="图像数据（Image Data）"></a>图像数据（Image Data）</h3><p>终于到了图片数据实际存储的地方。Image Data 是由一系列的输出编码（output codes）构成，它们告诉 decoder（解码器）需要绘制在画布上的每个颜色信息。这些编码以字节码的形式组织在这个块中。</p>
<h3 id="文件终结器（Trailer）"><a href="#文件终结器（Trailer）" class="headerlink" title="文件终结器（Trailer）"></a>文件终结器（Trailer）</h3><p>该块为一个单字段块，用来指示该数据流的结束。取固定值 0x3b.</p>
<p>更多参见 <a href="http://www.jianshu.com/p/df52f1511cf8" target="_blank" rel="noopener">gif 格式图片详细解析</a></p>
<h2 id="空间轴"><a href="#空间轴" class="headerlink" title="空间轴"></a>空间轴</h2><p>由于 GIF 的动态特性，由一帧帧的图片构成，所以每一帧的图片，多帧图片间的结合，都成了隐藏信息的一种载体。</p>
<p>对于需要分离的 GIF 文件，可以使用 <code>convert</code> 命令将其每一帧分割开来</p>
<pre class="line-numbers language-sourceCode"><code class="language-sourceCode">root in ~/Desktop/tmp λ convert cake.gif cake.png
root in ~/Desktop/tmp λ ls
cake-0.png  cake-1.png  cake-2.png  cake-3.png  cake.gif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="例题-3"><a href="#例题-3" class="headerlink" title="例题"></a>例题</h3><blockquote>
<p>WDCTF-2017:3-2</p>
</blockquote>
<p>打开 gif 后，思路很清晰，分离每一帧图片后，将起合并得到完整的二维码即可</p>
<pre class="line-numbers language-sourceCode"><code class="language-sourceCode">from  PIL import Image


flag = Image.new ("RGB",(450,450))

for i in range (2):
    for j in range (2):
        pot = "cake-{}.png".format (j+i*2)
        potImage = Image.open (pot)
        flag.paste (potImage,(j*225,i*225))
flag.save ('./flag.png')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>扫码后得到一串 16 进制字符串</p>
<p><code>03f30d0ab8c1aa5....74080006030908</code></p>
<p>开头 <code>03f3</code> 为 <code>pyc</code> 文件的头，恢复为 <code>python</code> 脚本后直接运行得到 flag</p>
<h2 id="时间轴"><a href="#时间轴" class="headerlink" title="时间轴"></a>时间轴</h2><p>GIF 文件每一帧间的时间间隔也可以作为信息隐藏的载体。</p>
<p>例如在当时在 XMan 选拔赛出的一题</p>
<blockquote>
<p>XMAN-2017:100.gif</p>
</blockquote>
<p>通过 <code>identify</code> 命令清晰的打印出每一帧的时间间隔</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ identify -format "% s % T \n" 100.gif
0 66
1 66
2 20
3 10
4 20
5 10
6 10
7 20
8 20
9 20
10 20
11 10
12 20
13 20
14 10
15 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>推断 <code>20 &amp; 10</code>  分别代表 <code>0 &amp; 1</code>，提取每一帧间隔并进行转化。</p>
<pre class="line-numbers language-shell"><code class="language-shell">$ cat flag|cut -d ' ' -f 2|tr -d '66'|tr -d '\n'|tr -d '0'|tr '2' '0'
0101100001001101010000010100111001111011001110010011011000110101001101110011010101100010011001010110010101100100001101000110010001100101011000010011000100111000011001000110010101100100001101000011011100110011001101010011011000110100001100110110000101100101011000110110011001100001001100110011010101111101#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>最后转 ASCII 码得到 flag。</p>
<h2 id="隐写软件-2"><a href="#隐写软件-2" class="headerlink" title="隐写软件"></a>隐写软件</h2><ul>
<li><a href="https://github.com/matthewgao/F5-steganography" target="_blank" rel="noopener">F5-steganography</a></li>
</ul>
<h1 id="概括与总结"><a href="#概括与总结" class="headerlink" title="概括与总结"></a>概括与总结</h1><p>看到这里，你应该对图片隐写有了基本的了解了，是不是依然感觉迷茫呢？下面的总结或许会帮到你。</p>
<h2 id="附加式的图片隐写"><a href="#附加式的图片隐写" class="headerlink" title="附加式的图片隐写"></a>附加式的图片隐写</h2><p>在附加式的图片隐写术中，通常用某种程序或者某种方法在载体文件中直接附加上需要被隐写的目标，然后将载体文件直接传输给接受者或者发布到网站上，然后接受者者根据方法提取出被隐写的消息，这一个过程就是附加式图片隐写。</p>
<p>在 CTF 赛事中，关于这种图片隐写的大概有两种经典方式，一是直接附加字符串，二是图种的形式出现。</p>
<blockquote>
<p>A. 附加字符串  </p>
</blockquote>
<p>这种方式是利用工具将隐藏信息直接写入到图片结束符之后，由于计算机中图片处理程序识别到图片结束符就不再继续向下识别，因此后面的信息就被隐藏起来。这种方式可以利用 winhex，ghex 等工具进行打开，或者 notepad 打开也可看到最后的附加的字符，所以虽然简单，但是隐藏效果不是很好。</p>
<p>windows 下制作这种图片的方式也有很多，比如刚才说到的 winhex 直接在文件尾写入字节，或利用 copy /b a.jpg+b.txt c.jpg 来进行制作。其中 a.jpg 是一张普通图片，即将作为信息的载体，b.txt 中是隐藏的信息，c.jpg 是附加了隐藏信息的图片，发送时就是发送 c.jpg。</p>
<blockquote>
<p>B. 图种</p>
</blockquote>
<p>图种是一种采用特殊方式将图片文件（如 jpg 格式）与 rar 文件结合起来的文件。该文件一般保存为 jpg 格式，可以正常显示图片，当有人获取该图片后，可以修改文件的后缀名，将图片改为 rar 压缩文件，便可得到其中的数据。刚才我们说过，因为计算机中图片处理程序识别图片的过程是，从图片头开始，以图片头声明的格式所定义的编码格式对数据流进行读取，一直到图片的结束符，当图片处理程序识别到图片的结束符后，不再继续向下识别，所以我们在通常情况下只能看到它是只是一张图片。</p>
<p>但使用 binwalk 程序可以轻松对其进行识别并还原，binwalk 程序在上面有讲解。也可以利用 winhex 寻找到图片的结束符，然后在其后查找是否有 zip 或 rar 等文件的文件头。最后也可利用转换文件后缀对其进行读取并解压，具体过程在这篇博客中有用到。</p>
<h2 id="基于文件结构的图片隐写"><a href="#基于文件结构的图片隐写" class="headerlink" title="基于文件结构的图片隐写"></a>基于文件结构的图片隐写</h2><p>这里的文件结构特指的是图片文件的文件结构。我们这里主要讲的是 PNG 图片的文件结构。  </p>
<p>PNG，图像文件存储格式，其设计目的是试图替代 GIF 和 TIFF 文件格式，同时增加一些 GIF 文件格式所不具备的特性。是一种位图文件 (bitmap file) 存储格式，读作 “ping”。PNG 用来存储灰度图像时，灰度图像的深度可多到 16 位，存储彩色图像时，彩色图像的深度可多到 48 位，并且还可存储多到 16 位的 α 通道数据。</p>
<p>对于一个正常的 PNG 图片来讲，其文件头总是由固定的字节来表示的，其 16 进制表示为 89 50 4E 47 0D 0A 1A 0A，这一部分称作 PNG 文件头。<br>标准的 PNG 文件结构应包括：<br>1.PNG 文件标识</p>
<p>2.PNG 数据块 PNG 图片有两种数据块的，一种是关键数据块，另一种是辅助数据块。正常的关键数据块，定义了 4 种标准数据块，分别是长度，数据块类型码，数据块数据，循环冗余检测即 CRC，每个 PNG 文件都必须包含它们。<br>我们这里重点先了解一下，PNG 图片文件头数据块以及 PNG 图片 IDAT 块，这次的隐写也是以这两个地方为基础的。</p>
<p><em><em>PNG 图片文件头数据块 </em></em><br>即 IHDR (Image HeaDeR)，这是 PNG 图片的第一个数据块，一张 PNG 图片仅有一个 IHDR 数据块，它包含了图片的宽，高，图像深度，颜色类型，压缩方法等等信息。(即定义图片数据流的读取规则)</p>
<p><em><em>PNG 图片 IDAT (Image DATa) 数据块 </em></em><br>它存储实际的数据，在数据流中可包含多个连续顺序的图像数据块。这是一个可以存在多个数据块类型的数据块。它的作用就是存储着图像真正的数据。因为它是可以存在多个的，所以即使我们写入一个多余的 IDAT 也不会明显影响肉眼对图片的观察。</p>
<blockquote>
<p>高度被修改引起的隐写</p>
</blockquote>
<p>刚才我们了解到，IHDR 中定义了图片的高度和宽度，可以通过修改高度值或宽度值对部分信息进行隐藏。</p>
<p>如果图片原本是 800 (宽)<em>600 (高)，然后图片的高度从 600 变成 500，这样下面 800×100 区域的信息就无法从图片中显示出来，我们可见的只有上方 800</em>500 的区域，这样就达成了图片隐写的目的。同理可知图片的宽度也可以进行类似的修改以达到隐藏信息的目的。</p>
<p>为了还原图片，可以利用 winhex 或者 010Editor 等编辑器打开图片。但我们推荐后者，因为它提供了不同文件的模板，通过加载 png 模板，我们可以直观的知道哪里是 PNG 的长度字段或宽度字段，它提供了 hex 字符串到字段名的映射，更便于我们进行修改。在修改文件后，需要利用 CRC Calculator 对 CRC 校验码进行重新计算赋值，以防图片被修改后，自身的 CRC 校验报错，导致图片不能正常打开。</p>
<blockquote>
<p>图片中加入 IDAT 块以实现隐写</p>
</blockquote>
<p>刚才我们提到过一个图片的 IDAT 块是可以存在多个的，这也导致我们可以利用添加 IDAT 块的方式来实现信息的隐写。</p>
<p>利用 PNGcheck 软件可以验证 PNG 文件的完整性，利用 pngcheck -v a.jpg 可以对图片的文件结构进行检测。</p>
<p>文件结构中可能会存在 size=0 的 IDAT 块，这说明相应的块是无法用肉眼看到的，也即隐藏的内容。可以通过脚本对隐藏内容进行提取。现在我还没有刷到类似的题，刷到了会补链接和代码。</p>
<h2 id="基于-LSB-原理的图片隐写"><a href="#基于-LSB-原理的图片隐写" class="headerlink" title="基于 LSB 原理的图片隐写"></a>基于 LSB 原理的图片隐写</h2><p>LSB，最低有效位，英文是 Least Significant Bit 。我们知道图像像素一般是由 RGB 三原色（即红绿蓝）组成的，每一种颜色占用 8 位，0x00~0xFF，即一共有 256 种颜色，一共包含了 256 的 3 次方的颜色，颜色太多，而人的肉眼能区分的只有其中一小部分，这导致了当我们修改 RGB 颜色分量中最低的二进制位的时候，我们的肉眼是区分不出来的。</p>
<h3 id="简单的-LSB-隐写"><a href="#简单的-LSB-隐写" class="headerlink" title="简单的 LSB 隐写"></a>简单的 LSB 隐写</h3><p>这种隐写仅对于某一通道值进行改写。将要隐写的信息图片直接覆盖该通道的相应值，即可实现信息的隐写。这种方式利用 Stegsolve 软件变换图层即可实现还原，相比而言隐秘性较低。</p>
<h3 id="有一点难度的-LSB-隐写"><a href="#有一点难度的-LSB-隐写" class="headerlink" title="有一点难度的 LSB 隐写"></a>有一点难度的 LSB 隐写</h3><p>最简单的隐写我们只需要通过工具 Stegsolve 切换到不同通道，可以直接看到隐写内容了，那么更复杂一点就不是这么直接了，而是只能通过工具来查看 LSB 的隐写痕迹，再通过工具或者脚本的方式提取隐写信息。</p>
<p>这种方式的解密，可以利用工具将每个 LSB 的值导出为一个流，然后转换为字符串进行读取。这种方式的隐蔽性相对来讲较高，一般难以发现。</p>
<h2 id="基于-DCT-域的-JPG-图片隐写"><a href="#基于-DCT-域的-JPG-图片隐写" class="headerlink" title="基于 DCT 域的 JPG 图片隐写"></a>基于 DCT 域的 JPG 图片隐写</h2><p>JPEG 图像格式使用离散余弦变换（Discrete Cosine Transform，DCT）函数来压缩图像，而这个图像压缩方法的核心是：通过识别每个 8×8 像素块中相邻像素的重复像素来减少显示图像所需的位数，并使用近似估算法降低其冗余度。因此，我们可以把 DCT 看作一个用于执行压缩的近似计算方法。因为丢失了部分数据，所以 DCT 是一种有损压缩（Loss Compression）技术，但一般不会影响图像的视觉效果。(有点 CNN 的影子)<br>在这个隐写家族中，常见的隐写方法有 JSteg、JPHide、Outguess、F5 等等</p>
<blockquote>
<p>Stegdetect</p>
</blockquote>
<p>实现 JPEG 图像 Jphide 隐写算法工具有多个，比如由 Neils Provos 开发通过统计分析技术评估 JPEG 文件的 DCT 频率系数的隐写工具 Stegdetect，它可以检测到通过 JSteg、JPHide、OutGuess、Invisible Secrets、F5、appendX 和 Camouflage 等这些隐写工具隐藏的信息，并且还具有基于字典暴力破解密码方法提取通过 Jphide、outguess 和 jsteg-shell 方式嵌入的隐藏信息。</p>
<blockquote>
<p>JPHS</p>
</blockquote>
<p>一款 JPEG 图像的信息隐藏软件 JPHS，它是由 Allan Latham 开发设计实现在 Windows 和 Linux 系统平台针对有损压缩 JPEG 文件进行信息加密隐藏和探测提取的工具。软件里面主要包含了两个程序 JPHIDE 和 JPSEEK， JPHIDE 程序主要是实现将信息文件加密隐藏到 JPEG 图像功能，而 JPSEEK 程序主要实现从用 JPHIDE 程序加密隐藏得到的 JPEG 图像探测提取信息文件，Windows 版本的 JPHS 里的 JPHSWIN 程序具有图形化操作界面且具备 JPHIDE 和 JPSEEK 的功能。</p>
<blockquote>
<p>Outguess</p>
</blockquote>
<p>Outgusee 算法是 Niels Provos 针对 Jsteg 算法的缺陷提出的一种方法：</p>
<ol>
<li><p>嵌入过程不修改 ECT 系数值为 0，1 的 DCT 系数，利用为随机数发生器产生间隔以决定下一个要嵌入的 DCT 系数的位置</p>
</li>
<li><p>纠正过程消除对效应的出现对应的，也有针对该算法的隐写工具，名字也叫 Outguess。</p>
</li>
</ol>
<p>对于这种隐写方法的还原，首先利用 Stegdetect 对图片进行检测，判断该图片利用的是何种隐写方式。然后针对不同的隐写方式，选择对应的工具进行信息的还原。比如利用 JPHS 还原 jphide 隐写，利用 Outguess 还原 outguess 隐写等等。</p>
<h2 id="容差比较的隐写"><a href="#容差比较的隐写" class="headerlink" title="容差比较的隐写"></a>容差比较的隐写</h2><p>容差，指的是在选取颜色时所设置的选取范围，容差越大，选取的范围也越大，其数值是在 0-255 之间。</p>
<p>在隐写术方面，可以根据容差进行信息的隐藏。若是有两张图片，则对两张图片的每一个像素点进行对比，设置一个容差的阈值 α，超出这个阈值的像素点 RGB 值设置为 (255,255,255), 若是没超过阈值，则设置该像素点的 RGB 值为 (0,0,0)。因此，通过调整不同的 α 值，可以使对比生成的图片呈现不同的画面。比如两张图完全一样，设置阈值 α 为任何值，最后得到的对比图都只会是全黑。若两张图每一个像素点都不同，阈值 α 设置为 1，则对比图将是全白。如果将隐藏信息附加到某些像素点上，这时调整阈值 α 即可看到隐藏信息。</p>
<p>如果是一张图片，则根据每一像素点周围像素的值进行判断，同样设置一个阈值，若当前像素点超过周围像素点的均值，或者其它的某种规则，则将该像素点 RGB 值置为 (255,255,255)，反之则不进行处理，或者设置为全 0. 这样也可以获得隐藏的信息。</p>
<h1 id="拓展推荐"><a href="#拓展推荐" class="headerlink" title="拓展推荐"></a>拓展推荐</h1><ul>
<li><a href="https://blog.csdn.net/qingchuwudi/article/details/25785307" target="_blank" rel="noopener">位图 (bmp) 文件格式分析</a></li>
<li><a href="https://blog.csdn.net/dyw_666666/article/details/88650738" target="_blank" rel="noopener">图片隐写查看神器 stegsolve 使用方法</a></li>
<li><a href="https://blog.csdn.net/joqian/article/details/8290389" target="_blank" rel="noopener">分析 PNG 图像结构</a></li>
<li><a href="https://blog.csdn.net/All__Blue/article/details/78218725?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">CTF 图片隐写题</a></li>
<li><a href="https://www.sqlsec.com/2018/01/ctfimg.html" target="_blank" rel="noopener">CTF 中图片隐写的一些整理总结</a></li>
</ul>

            </div>
            <hr />

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">写作不易，客官能否打赏一杯奶茶？</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《CTF-Image Analysis》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2020/04/01/ctf-image-analysis/" property="cc:attributionName"
               rel="cc:attributionURL">
                查令十字街
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/04/02/traffic-packet-analysis/">
                    <div class="card-image">
                        
                        <img src="https://s1.ax1x.com/2020/04/03/GNIU8H.jpg" class="responsive-img" alt="Traffic_Packet_Analysis">
                        
                        <span class="card-title">Traffic_Packet_Analysis</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文主要对流量包分析进行了一定的介绍，其中涉及HTTP、HTTPS、FTP、DNS、WIFI、USB。并对例题进行了一定的讲解。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2020-04-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF/" class="post-category" target="_blank">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/" target="_blank">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                    <a href="/tags/流量包分析/" target="_blank">
                        <span class="chip bg-color">流量包分析</span>
                    </a>
                    
                    <a href="/tags/整理总结/" target="_blank">
                        <span class="chip bg-color">整理总结</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/04/01/ctf-misc/">
                    <div class="card-image">
                        
                        <img src="https://s1.ax1x.com/2020/04/01/G1gNlj.jpg" class="responsive-img" alt="CTF-encode">
                        
                        <span class="card-title">CTF-encode</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本部分包含Misc的简介和encode的介绍，收集总结自CTF-wiki、维基百科，题目主要来源于Jarvis OJ，面向小白。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2020-04-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF/" class="post-category" target="_blank">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/" target="_blank">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                    <a href="/tags/Misc/" target="_blank">
                        <span class="chip bg-color">Misc</span>
                    </a>
                    
                    <a href="/tags/基础/" target="_blank">
                        <span class="chip bg-color">基础</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 查令十字街的博客<br />'
            + '作者: 查令十字街<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () { bodyElement.removeChild(newdiv); }, 200);
    });
</script>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2020-2020 查令十字街. 版权所有

            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">26.5k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
            <br>
            
            <span id="busuanzi_container_site_pv" style='display:none'>
                <i class="fa fa-heart-o"></i>
                本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
            <span id="busuanzi_container_site_uv" style='display:none'>
                人次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
            </span>
            
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/21ni" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:liut59357@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="https://zhihu.com/people/21ni" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-inverse">知</i>
    </a>



    <a href="http://wpa.qq.com/msgrd?v=3&uin=1316565360&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 0;
        var uvcountOffset = 0;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2020, 03, 30, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σσ(・Д・；)你丢了!!!", clearTimeout(st)) : (document.title = "(≧ω≦)/欢迎回来！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- 雪花特效 -->
    

</body>

</html>